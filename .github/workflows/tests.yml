name: CI

on:
  push:
    branches:
      - github-actions-for-ci

jobs:
  jest:
    name: Jest
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres
        env:
          POSTGRES_USER: keystone5
          POSTGRES_PASSWORD: k3yst0n3
          POSTGRES_DB: circle_test
        ports:
          - 5432:5432
    env:
      DATABASE_URL: 'postgres://keystone5:k3yst0n3@localhost:5432/circle_test'
    # strategy:
    #   matrix:
    #     node: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9]
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Install Dependencies
        uses: ./.github/install-dependencies
      - run: psql -d $DATABASE_URL -c "CREATE SCHEMA keystone;"
      - name: Unit tests
        run: yarn jest --ci --maxWorkers=1
        # env:
        #   CI_NODE_TOTAL: 10
        #   CI_NODE_INDEX: ${{ matrix.node }}
