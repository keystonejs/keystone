<!--[meta]
section: field-types
title: AutoIncrement
[meta]-->

# Keystone 5 `AutoIncrement` Field Type

An automatically incrementing integer with support for the Knex adapter.
Currently, outside it's use as a primary key, this field type will only work on PostgreSQL.

It's important to note, this type..

- Has [important limitations](#limitations) due to varying support from the underlying DB platform
- Has [non-standard defaults](#non-standard-defaults) for much of it's configuration

## Limitations

The majority of DB platforms allow only a single automatically incrementing column per table.
At time of writing (2019-07-11) this is true of
[SQLite](https://www.sqlite.org/autoinc.html),
[MySQL](https://dev.mysql.com/doc/refman/8.0/en/example-auto-increment.html),
[SQL Server](https://docs.microsoft.com/en-us/sql/t-sql/statements/create-table-transact-sql-identity-property),
[Oracle](https://docs.oracle.com/database/121/SQLRF/statements_7002.htm#SQLRF55661), and
[MariaDB](https://mariadb.com/kb/en/library/auto_increment/).
Further, it is often assumed these columns are the tables primary key.
On several platforms (eg. SQLite) auto increment functionality is _only_ available for primary keys.

Of the DB platforms supported by Knex, only
[PostgreSQL](https://www.postgresql.org/docs/9.1/datatype-numeric.html#DATATYPE-SERIAL) and
[Amazon Redshift](https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_TABLE_NEW.html#identity-clause)
supports _multiple_ auto incrementing columns.

## Non-Standard Defaults

The configuration for `AutoIncrement` fields has different default values than most field types.
Specifically:

- `isUnique` defaults to `true` --
  As unique values are generated by the DB it's assumed this uniqueness should be enforced with a unique constraint.
- `isNotNullable` defaults to `true` --
  Likewise, it's assumed values will never be updated or explicitly set to null.
  The column is set to be not nullable to enforce this.
- Read only --
  It's assumed `AutoIncrement` are not intended to be writable.
  Some DB platform will error if you attempt to update columns created by this type.
  Further, if the column has a unique constraint (as is the default; see `isUnique` in config above)
  inserting arbitrary values may cause errors when later records are created.
  As such, fields using this type default to being read-only.
  This is implemented by defaulting the `create`, `update` and `delete` field-level access control config to `false`.

## Usage

```js
const { Keystone } = require('@keystone-alpha/keystone');
const { AutoIncrement } = require('@keystone-alpha/fields-auto-increment');

const keystone = new Keystone(/* ... */);

keystone.createList('Order', {
  fields: {
    name: { type: Text },
    orderNumber: { type: AutoIncrement, knexOptions: { isPrimaryKey: false } },
    // ...
  },
});
```

### Config

| Option        | Type      | Default     | Description                                                     |
| :------------ | :-------- | :---------- | :-------------------------------------------------------------- |
| `isRequired`  | `Boolean` | `false`     | Does this field require a value?                                |
| `isUnique`    | `Boolean` | `true`      | Adds a unique index that allows only unique values to be stored |
| `knexOptions` | `Object`  | (see below) | (see below)                                                     |

### `knexOptions`

| Option         | Type      | Default | Description                                           |
| :------------- | :-------- | :------ | :---------------------------------------------------- |
| `isPrimaryKey` | `Boolean` | `true`  | Should Knex set this as the primary key for the table |

The setting `isPrimaryKey` to `false` prevents Knex from setting the columns as the primary key.
This is current only supported on PostgreSQL.
It works by substituting the generic `increments()` call for an explicitly build `serial` column.
See the [Limitations section](#limitations) more about auto inc and their usage as primary keys.

## Admin UI

`AutoIncrement` fields reuse the interface implementation from the native `Integer` field.

## GraphQL

`AutoIncrement` fields use the `Int` type in GraphQL.

### Input Fields

`AutoIncrement` fields are read-only by default.
As such, input fields and types may not be added to the GraphQL schema.
See the [non-standard defaults section](#non-standard-defaults) for details.

| Field name | Type  | Description               |
| :--------- | :---- | :------------------------ |
| `${path}`  | `Int` | The integer value to save |

### Output Fields

| Field name | Type  | Description              |
| :--------- | :---- | :----------------------- |
| `${path}`  | `Int` | The integer value stored |

### Filters

| Field name       | Type    | Description                                 |
| :--------------- | :------ | :------------------------------------------ |
| `${path}`        | `Int`   | Exact match to the value provided           |
| `${path}_not`    | `Int`   | Not an exact match to the value provided    |
| `${path}_lt`     | `Int`   | Less than the value provided                |
| `${path}_lte`    | `Int`   | Less than or equal to the value provided    |
| `${path}_gt`     | `Int`   | Greater than the value provided             |
| `${path}_gte`    | `Int`   | Greater or equal to than the value provided |
| `${path}_in`     | `[Int]` | In the array of integers provided           |
| `${path}_not_in` | `[Int]` | Not in the array of integers provided       |

## Storage

### Knex Adapter

The `AutoIncrement` field type uses [`increments()`](https://knexjs.org/#Schema-increments) by default.
The underlying implementation varies in significant ways depending on the DB platform used (see [limitations](#limitations)).

One implication of `increments()` is that Knex will
[always make it the primary key](https://github.com/tgriesser/knex/issues/385) of the table.
To work around this we've implemented the `knexOptions.isPrimaryKey` flag (see [`knexOptions`](#knexoptions)).
Passing this as `false` replaces the generic `increments()` call with an explicitly build `serial` column.
This is only supported on PostgreSQL.

### Mongoose Adapter

Not supported.
