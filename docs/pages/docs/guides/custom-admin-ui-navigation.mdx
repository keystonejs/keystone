import { Markdown } from '../../../components/Markdown';

# Custom Admin UI Navigation

In this guide, we'll illustrate how to create a custom Navigation component with custom routes to be rendered in the Admin-UI.

## Creating your custom Navigation component

### Navigation props

Keystone passes the following props to your custom Navigation component:

```ts
type NavigationProps {
    lists: ListMeta[];
    authenticatedItem: AuthenticatedItem;
}
```

`lists` is an array of list objects that include amongst other things routing information to be rendered by the custom Navigation component.

```ts
type ListMeta = {
  // key is used as the unique key for each navigation item in React.
  key: string;
  // href to the list route in the Admin-UI.
  path: string;
  // Used as the label for each navigation item.
  label: string;
  /** There are other properties as well */
};

```

`authenticatedItem` is a union of potential authentication states, expanded on below:

```ts
type AuthenticatedItem =
  | { state: 'unauthenticated' }
  | { state: 'authenticated'; label: string; id: string; listKey: string }
  | { state: 'loading' }
  | { state: 'error'; error: Error | readonly [GraphQLError, ...GraphQLError[]] };
```

This should be handled for you automatically by passing the prop into the `NavigationContainer`,

!> `NavigationContainer` is one of many assistive components to help you more easily compose your custom Navigation component. You can read more about it down [below](#components).

?> If you wish to render out the `authenticatedItem` in a custom manner, please be aware that you will need to handle all of the possible states of the `authenticatedItem`. Explaining how to do this is out of the scope of this particular guide.

### Components

Keystone exposes a variety of helper components to make building out your custom Admin-UI Navigation component easier. These are:

- NavigationContainer
- ListNavItems: A component that takes the `lists` array and renders out a list of NavItems.
- ListNavItem: A component that takes a list item and renders a NavItem.
- NavItem: A thin styling and accessibility wrapper around Next.js' Link component.

#### NavigationContainer

This is component renders containing markup around your routes, as well as as the different stats of the authenticatedItem prop.

```tsx
import { NavigationContainer} from '@keystone-next/keystone/admin-ui/components'
```

#### ListNavItems

This component takes the provided Array of `lists` and renders out a list of NavItems.

```tsx
import { ListNavItems } from '@keystone-next/keystone/admin-ui/components'
```

As mentioned above the routes object has the following type:

```typescript
type lists = ListMeta[]
type include = string[]
```

If an include prop is supplied, the component will only render out lists that match the list `keys` specified in the include array.

```tsx
const CustomNavigation = ({ lists }) => (
  <NavContainer>
    <ListNavItems lists={lists} include={["Task"]} />
  </NavContainer>
)
```

![example of navigation with include prop values](/assets/guides/custom-admin-ui-navigation/listNavItems-with-include.png)

Otherwise, all lists will be added.

```tsx
const CustomNavigation = ({lists}) => (
  <NavContainer>
    <ListNavItems lists={lists}/>
  </NavContainer>
)
```

![example of navigation without include prop values](/assets/guides/custom-admin-ui-navigation/listNavItems-without-include.png)

#### NavItem

This component is a thin styling and accessibility wrapper around the Link component from Next.js

```tsx
import { NavItem } from '@keystone-next/keystone/admin-ui/components'
```

It expects the following props.

```ts
type NavItemProps = {
   // The path or URL to navigate to
  href: string,
  // React children of the component
  children: ReactNode,
  // Toggles on the selected style and aria-current attribute of the NavItem
  isSelected: boolean
}
```

By default the `isSelected` value if left undefined, will be evaluated by the condition `router.pathname === href`, pass in `isSelected` if you have a custom condition or would like more granular control over the selected state of Navigation items.

### Piecing it all together

The code snippet below shows how to use these three components in conjunction to create a custom Navigation component that:

a) Has the styling constraints of the default Admin-UI navigation

b) Renders out all the necessary routes generated from our Keystone `lists`

c) Adds a new custom route to take us to the `keystonejs docs`.

d) Renders out additional UI based on whether or not the user has signed in provided by the `authenticatedItem` prop.

```tsx
// admin/components/CustomNavigation
import { NavigationContainer, NavItem, ListNavItems } from '@keystone-next/keystone/admin-ui/components';
import type { NavigationProps } from '@keystone-next/keystone/admin-ui/components';

export function CustomNavigation({ authenticatedItem, routes }: NavigationProps) {
  return (
    <NavigationContainer authenticatedItem={authenticatedItem}>
      <NavItem href="/">Dashboard</NavItem>
      <ListNavItems lists={lists}/>
      <NavItem href="https://keystonejs.com/guides/custom-navigation-guide">
        Navigation Guide
      </NavItem>
    </NavigationContainer>
  )
}
```

!> **Note** When opting into a custom Navigation component you will need to specify the a NavItem for the `Dashboard` page (the index route). Keysone doesn't provide this to you out of the box, as its not strictly a list concern, but doing so is relatively trivial as seen in the snippet above.

If you want a custom order to your list based NavItems or want to insert more custom markup but would still prefer not to pass list properties to `NavItem` yourself, you can use the exported `ListNavItem` component as below:

```tsx
// admin/components/CustomNavigation
import { NavigationContainer, NavItem, ListNavItem } from '@keystone-next/keystone/admin-ui/components';
import type { NavigationProps } from '@keystone-next/keystone/admin-ui/components';

export function CustomNavigation({ authenticatedItem, routes }: NavigationProps) {
  return (
    <NavigationContainer authenticatedItem={authenticatedItem}>
      <NavItem href="/">Dashboard</NavItem>
      {lists.map(list => (
        <>
          {/* Some additional custom markup here */}
          <ListNavItem list={list} />
        </>
      ))}
      <NavItem href="https://keystonejs.com/guides/custom-navigation-guide">
        Navigation Guide
      </NavItem>
    </NavigationContainer>
  )
}

```

## Adding the custom navigation component to the Admin-UI

Keystone is made aware of custom components it needs to render in the Admin-UI via the `/admin/config.ts` file in your project root.
Below is the expected type for the component export:

```ts
export type AdminConfig = {
  components?: {
    Logo?: (props: {}) => ReactElement;
    Navigation?: (props: NavigationProps) => ReactElement;
  };
};
```

Reference your custom Navigation component in the export as so, the exported component can either be declared inline or imported from elsewhere in your project.

```ts
import { CustomNavigation } from './components/CustomNavigation';
export  const component: AdminConfig['components'] = {
    Navigation: CustomNavigation
}
```

Once this is done, you should see your custom navigation component in your Admin-UI Navigation
![finished custom navigation example](/assets/guides/custom-admin-ui-navigation/final-result.png)

export default ({ children }) => <Markdown>{children}</Markdown>
