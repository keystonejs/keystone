import { Markdown } from '../../../components/Markdown';

# Custom Admin UI Navigation

In this guide, we'll show you how to create a custom Navigation component with custom routes to be rendered in the Admin UI.

## Creating your custom Navigation component

### Navigation props

Keystone passes the following props to your custom Navigation component:

```ts
type NavigationProps {
    lists: ListMeta[];
    authenticatedItem: AuthenticatedItem;
}
```

`lists` is an array of list objects that include amongst other things routing information to be rendered by the custom Navigation component.

```ts
type ListMeta = {
  // key is used as the unique key for each navigation item in React.
  key: string;
  // href to the list route in the Admin UI.
  path: string;
  // Used as the label for each navigation item.
  label: string;
  /** There are other properties as well */
};

```

`authenticatedItem` is a union of potential authentication states, expanded on below:

```ts
type AuthenticatedItem =
  | { state: 'unauthenticated' }
  | { state: 'authenticated'; label: string; id: string; listKey: string }
  | { state: 'loading' }
  | { state: 'error'; error: Error | readonly [GraphQLError, ...GraphQLError[]] };
```

The `authenticatedItem` props is rendered automatically when you pass it into the `NavigationContainer` component.

!> `NavigationContainer` is one of several higher-level components to help you more easily compose your custom Navigation component. You can read more about it down [below](#components).

?> If you render the `authenticatedItem` yourself, make sure you handle all of the possible states.

### Components

Keystone exposes a variety of helper components to make building out your custom Admin UI Navigation component easier. These are:

- [NavigationContainer](#navigation-container)
- [ListNavItems](#list-nav-items)
- [ListNavItem](#list-nav-item)
- [NavItem](#nav-item)

#### NavigationContainer

This component renders containing markup around your navigation links, as well as as the different states of the `authenticatedItem` prop.

```tsx
import { NavigationContainer } from '@keystone-next/keystone/admin-ui/components'
```

#### ListNavItems

This component takes the provided Array of `lists` and renders a list of `NavItems`.

```tsx
import { ListNavItems } from '@keystone-next/keystone/admin-ui/components'
```

As mentioned above the lists object has the following type:

```typescript
type lists = ListMeta[]
type include = string[]
```

If an include prop is supplied, the component will only render out lists that match the list `keys` specified in the include array.

```tsx
const CustomNavigation = ({ lists }) => (
  <NavigationContainer>
    <ListNavItems lists={lists} include={["Task"]} />
  </NavigationContainer>
)
```

![example of navigation with include prop values](/assets/guides/custom-admin-ui-navigation/listNavItems-with-include.png)

Otherwise, all lists will be added.

```tsx
const CustomNavigation = ({ lists }) => (
  <NavigationContainer>
    <ListNavItems lists={lists} />
  </NavigationContainer>
)
```

![example of navigation without include prop values](/assets/guides/custom-admin-ui-navigation/listNavItems-without-include.png)

#### ListNavItem

The `ListNavItem` component takes a single `list` object and renders a `NavItem`. This is a thin wrapper around `NavItem`, that automates the association of list properties to `NavItem`.
It also adds a custom `isSelected` expression optimised for Keystone lists.

```tsx
import { ListNavItem } from '@keystone-next/keystone/admin-ui/components';
```

It expects the following props.

```typescript
type ListNavItemProps = {
  list: ListMeta;
};
```

The idea behind `ListNavItem` is to have a higher-level abstraction that makes it easier to render navigation links for lists consistently.
This is especially relevant for future feature additions to the nav. (i.e. if we add icon support, that would work out of the box from a dependency bump for users of ListNavItem, whereas you'd have to add that icon prop manually with a lower level component.)

Use this component when you want to have more granular control over rendering nav items from lists prop provided to the `Navigation` component by Keystone,
but would still like to not have to worry about which list properties need to be associated with each `NavItem` prop.

#### NavItem

This component is a thin styling and accessibility wrapper around the Link component from Next.js

```tsx
import { NavItem } from '@keystone-next/keystone/admin-ui/components'
```

It expects the following props:

```ts
type NavItemProps = {
   // The path or URL to navigate to
  href: string,
  // React children of the component
  children: ReactNode,
  // Toggles on the selected style and aria-current attribute of the NavItem
  isSelected: boolean
}
```

By default the `isSelected` value if left undefined, will be evaluated by the condition `router.pathname === href`, pass in `isSelected` if you have a custom condition or would like more granular control over the selected state of Navigation items.

### Piecing it all together

The code snippet below shows how to use these three components in conjunction to create a custom Navigation component that:

a) Has the styling constraints of the default Admin UI navigation

b) Renders out all the necessary routes generated from our Keystone `lists`

c) Adds a new custom route to take us to the Keystone docs.

d) Renders additional UI based on whether or not the user has signed in provided by the `authenticatedItem` prop.

```tsx
// admin/components/CustomNavigation.tsx
import { NavigationContainer, NavItem, ListNavItems } from '@keystone-next/keystone/admin-ui/components';
import type { NavigationProps } from '@keystone-next/keystone/admin-ui/components';

export function CustomNavigation({ authenticatedItem, routes }: NavigationProps) {
  return (
    <NavigationContainer authenticatedItem={authenticatedItem}>
      <NavItem href="/">Dashboard</NavItem>
      <ListNavItems lists={lists} />
      <NavItem href="https://keystonejs.com/guides/custom-navigation-guide">
        Navigation Guide
      </NavItem>
    </NavigationContainer>
  )
}
```

!> **Note** When opting into a custom Navigation component you will need to specify a `NavItem` for the `Dashboard` page (the index route). Keystone doesn't provide this to you out of the box, as it's not strictly a list concern, but doing so is straight-forward as seen in the snippet above.

If you want a custom order to your list based NavItems or want to insert custom markup but would still prefer not to pass list properties to `NavItem` yourself, you can use the exported `ListNavItem` component as below:

```tsx
// admin/components/CustomNavigation.tsx
import { NavigationContainer, NavItem, ListNavItem } from '@keystone-next/keystone/admin-ui/components';
import type { NavigationProps } from '@keystone-next/keystone/admin-ui/components';

export function CustomNavigation({ authenticatedItem, routes }: NavigationProps) {
  return (
    <NavigationContainer authenticatedItem={authenticatedItem}>
      <NavItem href="/">Dashboard</NavItem>
      {lists.map(list => (
        <>
          {/* Some additional custom markup here */}
          <ListNavItem list={list} />
        </>
      ))}
      <NavItem href="https://keystonejs.com/guides/custom-navigation-guide">
        Navigation Guide
      </NavItem>
    </NavigationContainer>
  )
}

```

## Adding the custom navigation component to the Admin UI

Keystone is made aware of custom components it needs to render in the Admin UI via the `/admin/config.ts` file in your project root.
Below is the expected type for the component export:

```ts
export type AdminConfig = {
  components?: {
    Logo?: (props: {}) => ReactElement;
    Navigation?: (props: NavigationProps) => ReactElement;
  };
};
```

Reference your custom Navigation component in the export as so, the exported component can either be declared inline or imported from elsewhere in your project.

```ts
import { CustomNavigation } from './components/CustomNavigation';
export  const component: AdminConfig['components'] = {
    Navigation: CustomNavigation
}
```

Once this is done, you should see your custom navigation component in your Admin UI Navigation.
![finished custom navigation example](/assets/guides/custom-admin-ui-navigation/final-result.png)

export default ({ children }) => <Markdown>{children}</Markdown>
